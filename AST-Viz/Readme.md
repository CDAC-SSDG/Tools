# AST-Viz
---

This is a set of tools that help in visualization of AST's generated by Clang frontend of the LLVM compiler. It showcases the AST in form of graphs on a browser.


## Table of Contents

+ [How it works](https://github.com/CDAC-SSDG/Tools/edit/main/AST-Viz/Readme.md#how-it-works)
+ [Usage](https://github.com/CDAC-SSDG/Tools/edit/main/AST-Viz/Readme.md#usage)
  * Creating a JSON file
  * Verifying the JSON file generated
  * Splitting the JSON file
  * Visualizing the AST
+ [Help](https://github.com/CDAC-SSDG/Tools/edit/main/AST-Viz/Readme.md#help)
+ [Download Link](https://github.com/CDAC-SSDG/Tools/edit/main/AST-Viz/Readme.md#download-link)

## How it works

ASTViz contains a set of tools to convert Clang based AST to parsable JSON data and then makes visualization possible with GO-lang based server.

## Usage

### Creating a JSON file

It is possible to create a JSON format using clang's `-ast-dump` flag but it has a upper limit for the size.

Introducing `json_creator_test1.py` a tool which takes in Clang's AST dump and creates a JSON data file from it. It requires an input file that contains Clang's AST without any colored text and path to output json file. This can be achieved using

```bash
clang -Xclang -ast-dump -fno-diagnostics-color program1.cpp > <path_to_ast_file>
```

```bash
python3 json_creator.py <path_to_ast_file> <path_to_output_json_file>
```

Depending on the size of AST this might take a while. Once done verify the file using `json_verifier.py`.

### Verifying the JSON file generated

The JSON file produced by `json_creator.py` can be verified by executing following command

```bash
python3 json_verifier.py <path_to_ast_file> <path_to_generated_json_file>
```
### Splitting the JSON file

Even if the JSON file is generated it might not be possible for it to be parsed as a whole by the server. The greater the number of nodes in a AST the higher the memory usage is for a browser that visualizes it. Hence comes in `json_splitter_mathematical_way.py` - a tool for splitting the generated JSON into smaller chunks of JSON data. It breaks the JSON data with every new JSON containing a maximum of n nodes. This can be achieved using:

```bash
python3 json_splitter_mathematical_way.py <path_to_input_json_file> <path_to_output_directory> <max_number_of_nodes_allowed> <min_number_of_nodes>
```

This will create multiple JSON split files which are stored in `<path_to_output_directory>`.

**Note:** 
+ **This tool requires a max and min number of nodes that the new JSON can have. It is advisable to keep the min=max/2.**
+ **Since this new split JSON will be parsed by the server and visualized by the browser, it is advisable to not go beyond max=1800 as going beyond 1800 nodes will make use of more memory by the browser and parsing by server will be slow.**
+ **Just because min is set to an arbitary number x, does not mean the tool will not generate a JSON file having nodes less than x. Though the max number of nodes in a JSON are fixed and wouldn't cross that number.**

### Visualizing the AST 

The JSON files needs to be copied to path `/var/www/html/visualiser/testing/json_split_output/` inside the `ast_viz_server.sif` container. After that the server can be started using

```bash
singularity run ast_viz_server.sif
```

Finally the visualization of AST can be viewed using one's browser and visiting `http://<IP_address_of_machine_with_container_running>:6001`


## Help

In case of any help is required regarding the usage of ASTViz one can raise a issue/disscussion on this repository.

## Download Links

The files can be downloaded using [this link](https://ssdg.cdacb.in:5000/)
